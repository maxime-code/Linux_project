# recuperer le nombre de ligne du fichier
num_lines=$(wc -l < accounts.csv)

# decouper chaque colonne + retirer potentiel espaces dans les noms
values1=($(cut -d ';' -f 1 accounts.csv | sed 's/ //g'))
values2=($(cut -d ';' -f 2 accounts.csv | sed 's/ //g'))
values3=($(cut -d ';' -f 3 accounts.csv | sed 's/ //g'))
values4=($(cut -d ';' -f 4 accounts.csv | sed 's/ //g'))

mkdir /home/shared
chmod u+rx /home/shared
# boucle pour recuperer les infos de chaque colonne et faire des operations
for (( i=1; i<$num_lines; i++ )); do

#recuperer le mot de passe
	pass="${values4[$i]}"

# concatenation du prenom + nom
	first="${values1[$i]:0:1}"
	username="$first${values2[$i]}" 

	echo $username
	echo $pass	
# creer les user linux
	#useradd -m -p "$pass" $username
	#useradd -m $username
	test=bonjour
	useradd -m -p "$(openssl passwd -1 "$test")" "$username"
	#chage -d 0 "$username"
	
	#adduser --force-badname "$username"
	#usermod -p "$(openssl passwd -1 "$test")" "$username"  
	#mkdir /home/"$username"
	mkdir /home/"$username"/a_sauver
	#chmod a+rx /home/shared
	
	mkdir /home/shared/"$username"
	chmod u+rx /home/shared/"$username"
	chown "$username" /home/shared/"$username"
	chmod u+w /home/shared/"$username"
	#chown "$var":"$var" /home/shared/"$var"
	#chmod u+rwx,go+rx /home/shared/"$var"
	
	chown "$username":"$username" /home/"$username"
	chmod 700 /home/"$username"
	#test=bonjour
	#declare -p pass
	#echo $test  
	#echo "$username:$pass" | chpasswd
	#chpasswd $username:$pass
	#passwd $username
		
done
